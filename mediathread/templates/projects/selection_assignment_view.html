{% extends "base.html" %}
{% load user_projects %}

{% block title %}
    {% if assignment.title %}{{assignment.title}}{% else %}New Assignment{% endif %}
{% endblock %}

{% block css %}
    <link rel="stylesheet" href="{{STATIC_URL}}js/select2/select2.css" media="screen" />
    <link rel="stylesheet" href="{{STATIC_URL}}js/sherdjs/lib/mcePlugin_citation/skins/minimalist/citation.css" />
    <link rel="stylesheet" href="{{STATIC_URL}}css/project.css"  media="screen" />

    <!--All the annotation css -->
    {% include "djangosherd/annotator_resources_css.html" %}
{% endblock %}

{% block uncompressable_css %}
    <script type="text/javascript" src="{{STATIC_URL}}js/underscore/underscore-min.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}js/backbone/backbone-min.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}js/select2/select2.min.js"></script>
{% endblock %}

{% block js %}
    <!--All the annotation javascript -->
    {% include "djangosherd/annotator_resources.html" %}
        
    <script src="{{STATIC_URL}}jquery/js/jquery-ui-timepicker-addon.js" type="text/javascript"></script>
{% endblock %}

{% block uncompressable_js %}
    <script type="text/javascript" src="{{STATIC_URL}}js/select2/select2.min.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}jquery/js/jquery.masonry.min.js"></script>
    <script src="{{STATIC_URL}}js/app/projects/selection_assignment_view.js" type="text/javascript"></script>
    <script type="text/javascript">
        var view = new SelectionAssignmentView({
            el: jQuery('.selection-assignment').first(),
            viewer: '{{request.user.username}}',
            isFaculty: {% if is_faculty %}true{% else %}false{% endif %},
            assignmentId: '{{assignment.id}}',
            responseId: '{{my_response.id}}',
            itemId: '{{item.id}}',
            itemJson: JSON.parse('{{item_json|escapejs}}'),
            vocabulary: JSON.parse('{{vocabulary|escapejs}}'),
            submitted: {% if my_response and my_response.submitted %}true{% else %}false{% endif %},
            feedback: JSON.parse('{{feedback|escapejs}}')
        });
    </script>
{% endblock %}

{% block content %}
<div class="selection-assignment">
    <div class="row">
        <div class="col-md-3 column-container">
            <h2 class="">
                Selection Assignment
                {% if assignment_can_edit %}
                    <a class="right" href="{% url 'selection-assignment-edit' assignment.id %}">
                        <img alt="Edit" src="/media/img/icons/meth_edit.png"></span>
                    </a>
                {% endif %}
            </h2>
            <div class="small">
                <h1 class="project-title">{{assignment.title}}</h1><br />
                {% if assignment.due_date %}
                    <div class="meta">
                        <span class="metadata-label">
                            <b>Due</b>:
                        </span>
                        <span class="metadata-value">
                            {{assignment.due_date|date:'m/d/y'}}
                        </span>
                    </div>
                {% endif %}
                {% if is_faculty %}
                <div class="meta">
                    <span class="metadata-label"><b>Responses</b>:</span>
                    {% for key, value in response_view_policies %}
                        {% ifequal key assignment.response_view_policy %}
                            <span class="metadata-value">{{value}}</span>
                        {% endifequal %}
                    {% endfor %}
                    </a>
                </div>
                {% endif %}
                {% if assignment_can_edit %}
                    <div class="meta">
                        <span class="metadata-label"><b>Visibility</b>:</span>
                        <span class="metadata-value">
                            {{assignment.visibility_short}}
                        </span>
                    </div>
                {% endif %}
                <div class="clearfix"></div>
            </div>
            <p>{{assignment.body|safe}}</p>
        </div>
        <div class="col-md-9">
            <div class="row">
                <div class="col-md-7">
                    <div class="asset-view-header column-container">
                        <h2>Item
                            <span class="asset-view-title">
                                {{assignment.assignmentitem_set.first.asset.title}}
                             </span>
                        </h2>
                    </div>
                </div>
                <div class="col-md-4">
                    {% if not assignment_can_edit and not is_faculty %}
                        {% if my_response.submitted %}
                            <div class="right">
                                <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> 
                                <strong>Submitted</strong> {{my_response.submitted_date}}
                            </div>
                        {% else %}{% if my_response %}
                            <div>
                                <div class="left">
                                    <!-- Submit -->
                                    <button type="button" class="btn btn-primary btn-show-submit" style="display: inline">
                                        Submit Response
                                    </button>
                                </div>
                                <div class="right">
                                    <span class="glyphicon glyphicon-asterisk" aria-hidden="true"></span> 
                                    <strong>Draft</strong>
                                </div>
                            </div>
                            <div class="modal fade" id="cannot-submit-project" tabindex="-1"
                                role="dialog" aria-labelledby="Cannot Submit Response">
                              <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                  <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title">Submit Response</h4>
                                  </div>
                                  <div class="modal-body">
                                    <div>Your response is incomplete.</div><br />
                                  </div>
                                  <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                  </div>
                                </div>
                              </div>
                            </div>                            
                            
                            <div class="modal fade" id="submit-project" tabindex="-1"
                                role="dialog" aria-labelledby="Submit Project">
                              <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                  <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title">Submit Response</h4>
                                  </div>
                                  <div class="modal-body">
                                    <form method="post" class="project-response-form"
                                        action="{% url 'project-save' my_response.id %}">

                                        <div>Please make sure your work is complete before submission</div><br />
                                        <div><strong>Checklist</strong></div><br />
                                        <ul>
                                            <li>Have you completed the required selections?</li>
                                            <li>Have you made notes, if applicable?</li>
                                            <li>Have you tagged selections, if applicable?</li>
                                            <li>Have you added vocabulary terms to the selections, if applicable?</li>
                                        </ul>
                                        <br />
                                        <div class="alert alert-danger" role="alert">
                                            <strong>Important!</strong> Once you submit your response, you cannot unsubmit it.
                                        </div>
                                        <input type="hidden" name="publish" value="{{submit_policy}}" />
                                        <input type="hidden" name="title" value="{{my_response.title}}" />
                                    </form>
                                  </div>
                                  <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary submit-response">Submit</button>
                                  </div>
                                </div>
                              </div>
                            </div>                            
                        {% endif %}{% endif %}
                    {% endif %}
                </div>
            </div>
            <div class="row">
                <div class="col-md-7">
                    <div class="asset-view-published affix affix-top" data-spy="affix">
                        <div id="asset-workspace-videoclipbox" class="videoclipbox" style="display: none;">
                            <div class="asset-object" style="border: none; background-color: #ededed;"></div>
                            <div class="asset-display"></div>
                            <div class="clipstrip-display"></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    {% if not is_faculty and not my_response %}
                        <div class="text-center">
                            <form action="/project/create/" method="post">
                                <input type="hidden" name="parent" value="{{assignment.id}}" />
                                <input type="hidden" name="project_type" value="composition" />
                                <input type="hidden" name="title" value="My Response" />
                                <input class="btn btn-success" type="submit" value="Respond to Assignment" />
                            </form>
                        </div>
                    {% endif %}
                    {% if responses|length < 1 %}
                        {% if is_faculty %}
                            <div class="well">No responses yet</div>
                        {% endif %}
                    {% else %}
                        {% if my_response or is_faculty %}
                            <div id="asset-workspace-panel-container" class="asset-workspace column-container">
                                <div id="asset-view-details" class="asset-view-details"></div>
                            </div>
                        {% endif %}
                    {% endif %}                
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}