{% extends "base.html" %}
{% load user_projects %}

{% block title %}
    {% if assignment.title %}{{assignment.title}}{% else %}New Assignment{% endif %}
{% endblock %}

{% block css %}
    <link rel="stylesheet" href="{{STATIC_URL}}js/select2/select2.css" media="screen" />
    <link rel="stylesheet" href="{{STATIC_URL}}js/sherdjs/lib/mcePlugin_citation/skins/minimalist/citation.css" />

    <!--All the annotation css -->
    {% include "djangosherd/annotator_resources_css.html" %}
{% endblock %}

{% block uncompressable_css %}
    <script type="text/javascript" src="{{STATIC_URL}}js/underscore/underscore-min.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}js/backbone/backbone-min.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}js/select2/select2.min.js"></script>
{% endblock %}

{% block js %}
    <!--All the annotation javascript -->
    {% include "djangosherd/annotator_resources.html" %}
        
    <script src="{{STATIC_URL}}jquery/js/jquery-ui-timepicker-addon.js" type="text/javascript"></script>
{% endblock %}

{% block uncompressable_js %}
    <script type="text/javascript" src="{{STATIC_URL}}js/select2/select2.min.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}jquery/js/jquery.masonry.min.js"></script>
    <script src="{{STATIC_URL}}js/app/projects/selection_assignment_view.js" type="text/javascript"></script>
    <script type="text/javascript">
        var view = new SelectionAssignmentView({
            el: jQuery('.selection-assignment').first(),
            assignmentId: '{{assignment.id}}',
            responseId: '{{my_response.id}}',
            itemId: '{{item.id}}',
            itemJson: JSON.parse('{{item_json|escapejs}}'),
            vocabulary: JSON.parse('{{vocabulary|escapejs}}'),
            submitted: {% if my_response and my_response.submitted %}true{% else %}false{% endif %}
        });
    </script>
{% endblock %}

{% block content %}
<div class="selection-assignment">
    <div class="row">
        <div class="col-md-3 column-container">
            <h2 class="">
                Selection Assignment
                {% if assignment_can_edit %}
                    <a class="right" href="{% url 'selection-assignment-edit' assignment.id %}">
                        <img alt="Edit" src="/media/img/icons/meth_edit.png"></span>
                    </a>
                {% endif %}
            </h2>
            <div class="small">
                <h3>{{assignment.title}}</h3>
                {% if assignment_can_edit %}
                    <div><b>Visibility</b>: {{assignment.visibility_short}}</div>
                {% endif %}
                {% if project.due_date %}
                    <div><b>Due</b>: {{project.due_date|date:'m/d/y'}}</div>
                {% endif %}
                
                <div>
                    <b>Submitted Response Policy:</b>
                    {% for key, value in response_view_policies %}
                        {% ifequal key assignment.response_view_policy %}
                            {{value}}
                        {% endifequal %}
                    {% endfor %}
                    <a href="javascript:void(0);" data-toggle="tooltip" data-placement="left"
                    title="
                    The response policy controls who will see your work once you submit. For this assignment, once you submit your work, 
                    {% ifequal assignment.response_view_policy "never" %}
                        only your instructor will see your work.
                    {% else %}{% ifequal assignment.response_view_policy "submitted" %}
                        other students who have submitted their work can see your work.
                    {% else %}{% ifequal assignment.response_view_policy "always" %}
                        other students can see your work.
                    {% endifequal %}{% endifequal %}{% endifequal %}">
                    <span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span>
                    </a>
                </div>
            </div>
            <p>{{assignment.body|safe}}</p>
        </div>
        <div class="col-md-9">
            <div class="row">
                <div class="col-md-7">
                    <div class="asset-view-header">
                        <h2>Item
                            <span class="asset-view-title">
                                {{assignment.assignmentitem_set.first.asset.title}}
                             </span>
                        </h2>
                    </div>
                </div>
                <div class="col-md-4">
                    {% if not assignment_can_edit %}
                        {% if not my_response %}
                            <div class="text-right">
                                <form action="/project/create/" method="post">
                                    <input type="hidden" name="parent" value="{{assignment.id}}" />
                                    <input type="hidden" name="project_type" value="composition" />
                                    <input type="hidden" name="title"
                                        value="Response" />
                                    <input class="btn btn-success" type="submit" value="Respond to Assignment" />
                                </form>
                            </div>
                        {% else %}{% if my_response.submitted %}
                            <div class="right">
                                <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> 
                                <strong>Submitted</strong> {{my_response.submitted_date}}
                            </div>
                        {% else %}
                            <!--  @todo only show the submit button if work has been done
                            if my_response.notes|length > 0 %} --->
                            <div class="text-right">
                                <!--  Submit -->
                                <button type="button" class="btn btn-primary"
                                    data-toggle="modal" data-target="#submit-project">
                                    Submit Response
                                </button>
                            </div>
                            <div class="modal fade" id="submit-project" tabindex="-1"
                                role="dialog" aria-labelledby="myModalLabel">
                              <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                  <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title" id="myModalLabel">Submit Response</h4>
                                  </div>
                                  <div class="modal-body">
                                    <form method="post" class="project-response-form"
                                        action="{% url 'project-save' my_response.id %}">
                                        
                                        <div>Please make sure your work is complete before submission</div><br />
                                        <div><strong>Checklist</strong></div><br />
                                        <ul>
                                            <li>Have you completed the required selections?</li>
                                            <li>Have you made notes, if applicable?</li>
                                            <li>Have you tagged selections, if applicable?</li>
                                            <li>Have you added vocabulary terms to the selections, if applicable?</li>
                                        </ul>
                                        <br />
                                        <div class="alert alert-danger" role="alert">
                                            <strong>Important!</strong> Once you submit your response, you cannot unsubmit it.
                                        </div>
                                        <input type="hidden" name="publish" value="{{submit_policy}}" />
                                        <input type="hidden" name="title" value="Selection Assignment Response by {{request.user.get_full_name}}" />
                                    </form>
                                  </div>
                                  <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary submit-response">Submit</button>
                                  </div>
                                </div>
                              </div>
                            </div>                            
                        {% endif %}{% endif %}
                    {% endif %}
                </div>
            </div>
            <div class="row">
                <div class="col-md-7">
                    <div class="asset-view-published">
                        <div id="asset-workspace-videoclipbox" class="videoclipbox" style="display: none;">
                            <div class="asset-object" style="border: none; background-color: #ededed;"></div>
                            <div class="asset-display"></div>
                            <div class="clipstrip-display"></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    {% if my_response or assignment_can_edit %}
                        <div id="asset-view-details" class="asset-view-details"></div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}